<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lead Dashboard (Admin View)</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background-color: #f4f4f4;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #007bff;
        text-align: center;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
        cursor: pointer;
      }
      .error {
        color: red;
        font-weight: bold;
      }
      #dashboardControls button {
        padding: 10px 15px;
        margin: 0 10px;
        cursor: pointer;
        background-color: #f8f9fa;
        border: 1px solid #ced4da;
        border-radius: 5px;
        transition: all 0.2s;
    }
    #dashboardControls button.active {
        background-color: #007bff;
        color: white;
        border-color: #007bff;
    }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Website Leads Dashboard</h1>

      <div
        id="dashboardControls"
        style="text-align: center; margin-bottom: 20px"
      >
        <button data-collection="waitlist_leads" class="active">
          Waitlist Leads
        </button>
        <button data-collection="general_inquiries">General Inquiries</button>
        <button data-collection="expert_session_bookings">
          Expert Sessions
        </button>
      </div>

      <p id="status">Loading leads data...</p>
      <table id="leadsTable">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>

    <script>
      // --- VARIABLES ---
    //   const ADMIN_KEY = "prehome@321";
      // const API_URL = `/api/leads?key=${ADMIN_KEY}`; // Correctly uses the key
      // const API_URL = `http://localhost:5000/api/leads?key=${ADMIN_KEY}`;
    //   const RENDER_URL = "https://website-leads-dashboard.onrender.com";
    //   const API_URL = `${RENDER_URL}/api/leads?key=${ADMIN_KEY}`;
    //   const tableBody = document
    //     .getElementById("leadsTable")
    //     .querySelector("tbody");
    //   const tableHead = document
    //     .getElementById("leadsTable")
    //     .querySelector("thead");
    //   const statusElement = document.getElementById("status");

      const ADMIN_KEY = 'prehome@321'; 
const RENDER_URL = 'https://website-leads-dashboard.onrender.com'; // Your base URL
// const RENDER_URL = 'http://localhost:5000';
// NOTE: API_URL now becomes a function argument, not a fixed variable
const tableBody = document.getElementById('leadsTable').querySelector('tbody');
const tableHead = document.getElementById('leadsTable').querySelector('thead');
const statusElement = document.getElementById('status');
const controls = document.getElementById('dashboardControls');


      const ALL_FIELD_LABELS = {
        // 1. Waitlist Leads (Your existing structure)
        waitlist_leads: {
          name: "Name",
          email: "Email",
          phone: "Phone",
          selectedLocation: "Location",
          selectedLayout: "Layout",
          createdAt: "Date Submitted",
        },
        // 2. General Inquiries
        general_inquiries: {
          name: "Name",
          contact: "Phone/Contact", // Use "Contact" for the field
          location: "Client Location",
          message: "Message",
          createdAt: "Date Submitted",
        },
        // 3. Expert Session Bookings
        expert_session_bookings: {
          name: "Name",
          contact: "Email/Contact", // Use "Contact" for the field
          date: "Session Date",
          time: "Session Time",
          createdAt: "Date Submitted",
        },
      };



    async function fetchAndRenderLeads(collectionName) {
    statusElement.textContent = `Loading data from: ${collectionName}...`;
    statusElement.className = '';
    
    // Construct the dynamic API URL
    const API_URL = `${RENDER_URL}/api/data/${collectionName}?key=${ADMIN_KEY}`;

    try {
        const response = await fetch(API_URL); 

        if (!response.ok) {
             // ... error handling for 403, 400, 500 status ...
             const errorData = await response.json().catch(() => ({ message: 'Server did not return valid JSON.' }));
             statusElement.className = 'error';
             statusElement.textContent = `Error ${response.status}: ${errorData.message || 'Access was denied or Invalid Collection.'}`;
             return; 
        }

        const data = await response.json();

        if (data.success) { 
            const leads = data.leads;
            
            if (leads.length === 0) {
                statusElement.textContent = `No leads found in the collection: ${collectionName}.`;
                // Clear the table when empty
                tableBody.innerHTML = '';
                tableHead.innerHTML = '<tr><th colspan="6">No Data</th></tr>'; 
                return;
            }

            // ... (Table rendering logic is the same) ...
            // const fields = Object.keys(FIELD_LABELS);
            const FIELD_LABELS = ALL_FIELD_LABELS[collectionName];
            const fields = Object.keys(FIELD_LABELS);
            let headerRow = '<tr>';
            fields.forEach(field => { headerRow += `<th>${FIELD_LABELS[field]}</th>`; });
            headerRow += '</tr>';
            tableHead.innerHTML = headerRow;

            let tableRows = '';
            leads.forEach(lead => {
                tableRows += '<tr>';
                fields.forEach(field => {
                    let value = lead[field] || ''; 
                    if (field === 'createdAt' && value) { value = new Date(value).toLocaleString(); }
                    tableRows += `<td>${value}</td>`;
                });
                tableRows += '</tr>';
            });
            
            tableBody.innerHTML = tableRows;
            statusElement.textContent = `Displaying ${leads.length} leads from: ${collectionName}.`;

        } else {
            statusElement.className = 'error';
            statusElement.textContent = `Error: ${data.message || 'Failed to fetch data.'}`;
        }
    } catch (error) {
        statusElement.className = 'error';
        statusElement.textContent = `A network error occurred. Check server status. Details: ${error.message}`;
        console.error('Fetch error:', error);
    }
}


// --- EVENT LISTENERS AND INITIAL LOAD ---

// Add listener to the control buttons
controls.addEventListener('click', (event) => {
    const button = event.target;
    if (button.tagName === 'BUTTON' && button.dataset.collection) {
        // Remove 'active' class from all buttons
        controls.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
        // Add 'active' class to the clicked button
        button.classList.add('active');
        
        // Fetch the new data
        fetchAndRenderLeads(button.dataset.collection);
    }
});

// Run the function with the default collection when the page loads
const initialCollection = 'waitlist_leads';
fetchAndRenderLeads(initialCollection);


    </script>
  </body>
</html>
